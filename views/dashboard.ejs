<%- include('layout', { body: ` <section class="stats">
    <div>
        <span>Total Backups</span>
        <strong>${stats.totalBackups}</strong>
    </div>

    <div>
        <span>Backup Size</span>
        <strong>${stats.totalBackupSizeMB} MB</strong>
    </div>

    <div>
        <span>Log Files</span>
        <strong>${stats.logFiles}</strong>
    </div>

    <div>
        <span>Server Time</span>
        <strong>${stats.serverTime}</strong>
    </div>
    </section>

    <p id="lastUpdated" style="margin-top: -10px; color: #6b7280;"></p>

    <section class="chart-section">
        <h2>Backup Status</h2>
        <div class="chart-wrapper">
            <canvas id="backupChart"></canvas>
        </div>
    </section>

    <section>
        <h2>Backup Dates</h2>
        <ul>
            ${backupDates.map(d => `<li>${d}</li>`).join("")}
        </ul>
    </section>

    <section>
        <h2>Logs</h2>
        <ul>
            ${logs.map(l => `
            <li>
                <a href="/logs/${l.name}" target="_blank">
                    ${l.name}
                </a>
                <span style="color:#6b7280;font-size:0.85rem;">
                    ${l.size} KB
                </span>
            </li>
            `).join("")}
        </ul>
    </section>

    <!-- ===== SCRIPTS ===== -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- ===== SCRIPTS ===== -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        let chart;

        document.addEventListener("DOMContentLoaded", () => {
            loadStats();
            setInterval(loadStats, 10000);
        });

        async function loadStats() {
            try {
                const res = await fetch("/api/stats");
                const data = await res.json();

                if (!data.backups) {
                    console.error("Invalid stats response", data);
                    return;
                }

                const success = Number(data.backups.success || 0);
                const failure = Number(data.backups.failure || 0);

                const canvas = document.getElementById("backupChart");
                if (!canvas) return;

                if (!chart) {
                    chart = new Chart(canvas.getContext("2d"), {
                        type: "doughnut",
                        data: {
                            labels: ["Success", "Failure"],
                            datasets: [{
                                data: [success, failure],
                                backgroundColor: ["#22c55e", "#ef4444"]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false, // ðŸ”´ REQUIRED
                            plugins: {
                                legend: {
                                    position: "bottom"
                                }
                            }
                        }
                    });
                } else {
                    chart.data.datasets[0].data = [success, failure];
                    chart.update();
                }

                document.getElementById("lastUpdated").innerText =
                    "Last updated: " + data.time;

            } catch (err) {
                console.error("Failed to load stats", err);
            }
        }
    </script>


    ` }) %>